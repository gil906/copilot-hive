<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 880 480">
  <defs>
    <linearGradient id="bgFail" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0d1117"/>
      <stop offset="100%" style="stop-color:#161b22"/>
    </linearGradient>
    <filter id="shd"><feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.4"/></filter>
    <marker id="aR" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#f85149"/>
    </marker>
    <marker id="aG" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#3fb950"/>
    </marker>
    <marker id="aY" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#f0b429"/>
    </marker>
    <marker id="aB" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#58a6ff"/>
    </marker>
  </defs>
  
  <rect width="880" height="480" rx="12" fill="url(#bgFail)"/>
  <rect x="1" y="1" width="878" height="478" rx="12" fill="none" stroke="#30363d" stroke-width="1"/>

  <!-- Title -->
  <text x="440" y="35" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="18" font-weight="700" fill="#f0b429">ğŸ›¡ï¸ SMART FAILURE COORDINATION</text>
  <text x="440" y="55" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#8b949e">The agent that broke things gets first chance to fix it</text>

  <!-- â”€â”€ TRIGGER â”€â”€ -->
  <g filter="url(#shd)">
    <rect x="340" y="75" width="200" height="55" rx="10" fill="#21262d" stroke="#f85149" stroke-width="2.5"/>
    <circle cx="360" cy="102" r="8" fill="#f85149" opacity="0.3">
      <animate attributeName="r" values="6;12;6" dur="1s" repeatCount="indefinite"/>
      <animate attributeName="opacity" values="0.1;0.4;0.1" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="360" cy="102" r="5" fill="#f85149">
      <animate attributeName="opacity" values="0.5;1;0.5" dur="1s" repeatCount="indefinite"/>
    </circle>
    <text x="448" y="100" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="16" fill="#f85149" font-weight="700">âš ï¸ Deploy Failed!</text>
    <text x="448" y="118" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">Version mismatch detected</text>
  </g>

  <!-- Arrow down -->
  <line x1="440" y1="133" x2="440" y2="160" stroke="#f85149" stroke-width="2.5" marker-end="url(#aR)" stroke-dasharray="5,3">
    <animate attributeName="stroke-dashoffset" values="0;-16" dur="0.6s" repeatCount="indefinite"/>
  </line>

  <!-- â”€â”€ WHO BROKE IT â”€â”€ -->
  <g filter="url(#shd)">
    <rect x="310" y="165" width="260" height="50" rx="10" fill="#21262d" stroke="#58a6ff" stroke-width="1.5"/>
    <text x="440" y="187" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="13" fill="#58a6ff" font-weight="600">ğŸ” Who pushed the bad code?</text>
    <text x="440" y="205" text-anchor="middle" font-family="monospace" font-size="11" fill="#8b949e">FIX_RESPONSIBILITY = developer</text>
  </g>

  <!-- Arrow down -->
  <line x1="440" y1="218" x2="440" y2="245" stroke="#f0b429" stroke-width="2" marker-end="url(#aY)">
  </line>

  <!-- â”€â”€ ATTEMPT 1 â”€â”€ -->
  <g filter="url(#shd)">
    <rect x="260" y="250" width="360" height="65" rx="10" fill="#21262d" stroke="#f0b429" stroke-width="2"/>
    <rect x="260" y="250" width="360" height="26" rx="10" fill="#f0b429" opacity="0.1"/>
    
    <!-- Attempt badge -->
    <rect x="275" y="256" width="80" height="16" rx="8" fill="#f0b429" opacity="0.2"/>
    <text x="315" y="268" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="10" fill="#f0b429" font-weight="700">ATTEMPT 1</text>
    
    <text x="440" y="268" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="13" fill="#e6edf3" font-weight="600">ğŸ”§ Re-run SAME agent with fix prompt</text>
    <text x="440" y="292" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#8b949e">It has context about what it changed â€” best chance to fix</text>
    <text x="440" y="308" text-anchor="middle" font-family="monospace" font-size="11" fill="#f0b429">"Your last push broke the deploy. Fix it."</text>
  </g>

  <!-- Fixed? branch -->
  <!-- Yes arrow (right) -->
  <line x1="623" y1="282" x2="700" y2="282" stroke="#3fb950" stroke-width="2.5" marker-end="url(#aG)" stroke-dasharray="6,3">
    <animate attributeName="stroke-dashoffset" values="0;-18" dur="0.8s" repeatCount="indefinite"/>
  </line>
  <text x="660" y="275" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#3fb950" font-weight="600">Fixed? âœ…</text>

  <!-- Success box 1 -->
  <g filter="url(#shd)">
    <rect x="705" y="262" width="150" height="42" rx="10" fill="#21262d" stroke="#3fb950" stroke-width="2"/>
    <text x="780" y="288" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="13" fill="#3fb950" font-weight="700">âœ… Continue Pipeline</text>
  </g>

  <!-- No arrow (down) -->
  <line x1="440" y1="318" x2="440" y2="345" stroke="#f85149" stroke-width="2" marker-end="url(#aR)">
  </line>
  <text x="460" y="335" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#f85149">No âœ—</text>

  <!-- â”€â”€ ATTEMPT 2 â”€â”€ -->
  <g filter="url(#shd)">
    <rect x="260" y="350" width="360" height="50" rx="10" fill="#21262d" stroke="#f0b429" stroke-width="1.5"/>
    <rect x="260" y="350" width="360" height="22" rx="10" fill="#f0b429" opacity="0.08"/>
    
    <rect x="275" y="355" width="80" height="14" rx="7" fill="#f0b429" opacity="0.2"/>
    <text x="315" y="366" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="9" fill="#f0b429" font-weight="700">ATTEMPT 2</text>
    
    <text x="445" y="366" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#e6edf3" font-weight="600">ğŸ”§ Re-run same agent again (last chance)</text>
    <text x="440" y="392" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#8b949e">Same agent, same context â€” second and final retry</text>
  </g>

  <!-- Fixed? branch -->
  <line x1="623" y1="375" x2="700" y2="375" stroke="#3fb950" stroke-width="2.5" marker-end="url(#aG)" stroke-dasharray="6,3">
    <animate attributeName="stroke-dashoffset" values="0;-18" dur="0.8s" repeatCount="indefinite"/>
  </line>
  <text x="660" y="368" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#3fb950" font-weight="600">Fixed? âœ…</text>

  <g filter="url(#shd)">
    <rect x="705" y="355" width="150" height="42" rx="10" fill="#21262d" stroke="#3fb950" stroke-width="2"/>
    <text x="780" y="381" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="13" fill="#3fb950" font-weight="700">âœ… Continue Pipeline</text>
  </g>

  <!-- No arrow (down) â€” ESCALATE -->
  <line x1="440" y1="403" x2="440" y2="425" stroke="#f85149" stroke-width="3" marker-end="url(#aR)" stroke-dasharray="4,2">
    <animate attributeName="stroke-dashoffset" values="0;-12" dur="0.4s" repeatCount="indefinite"/>
  </line>
  <text x="462" y="418" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#f85149" font-weight="700">ESCALATE!</text>

  <!-- â”€â”€ EMERGENCY FIXER â”€â”€ -->
  <g filter="url(#shd)">
    <rect x="240" y="430" width="400" height="40" rx="10" fill="#21262d" stroke="#f85149" stroke-width="2.5"/>
    <rect x="240" y="430" width="400" height="40" rx="10" fill="#f85149" opacity="0.08"/>
    <circle cx="260" cy="450" r="6" fill="#f85149">
      <animate attributeName="opacity" values="0.3;1;0.3" dur="0.6s" repeatCount="indefinite"/>
    </circle>
    <text x="445" y="455" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="15" fill="#e6edf3" font-weight="700">ğŸš‘ EMERGENCY FIXER â€” Full Diagnostics Mode</text>
  </g>

  <!-- Side panel: What Emergency Fixer Gets -->
  <g filter="url(#shd)">
    <rect x="30" y="75" width="260" height="210" rx="10" fill="#21262d" stroke="#30363d" stroke-width="1"/>
    <rect x="30" y="75" width="260" height="28" rx="10" fill="#58a6ff" opacity="0.08"/>
    <text x="160" y="95" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#58a6ff" font-weight="600">ğŸ” Emergency Fixer Receives</text>
    
    <text x="45" y="120" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ Alert context from Uptime Kuma</text>
    <text x="45" y="140" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ Pipeline state + which agent broke it</text>
    <text x="45" y="160" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ Docker container logs (last 50 lines)</text>
    <text x="45" y="180" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ Container health check status</text>
    <text x="45" y="200" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ HTTP response codes (all services)</text>
    <text x="45" y="220" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ GitHub Actions build logs</text>
    <text x="45" y="240" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#8b949e">ğŸ“‹ Previous agent's fix attempts</text>
    <text x="45" y="268" font-family="monospace" font-size="10" fill="#f85149">Fix â†’ Push â†’ Deploy â†’ Verify</text>
  </g>

  <!-- Right panel: Version Check -->
  <g filter="url(#shd)">
    <rect x="660" y="75" width="200" height="170" rx="10" fill="#21262d" stroke="#30363d" stroke-width="1"/>
    <rect x="660" y="75" width="200" height="28" rx="10" fill="#3fb950" opacity="0.08"/>
    <text x="760" y="95" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#3fb950" font-weight="600">ğŸ”– Version Check</text>
    
    <text x="675" y="120" font-family="monospace" font-size="10" fill="#8b949e">GET /api/version</text>
    <rect x="675" y="128" width="170" height="35" rx="6" fill="#161b22" stroke="#30363d" stroke-width="0.5"/>
    <text x="680" y="144" font-family="monospace" font-size="10" fill="#58a6ff">{ "build_id":</text>
    <text x="686" y="158" font-family="monospace" font-size="10" fill="#f0b429">"1740234-a1b2" }</text>
    
    <text x="675" y="180" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#3fb950">Expected: 1740234-a1b2</text>
    <text x="675" y="198" font-family="'Segoe UI',system-ui,sans-serif" font-size="11" fill="#3fb950">Running:  1740234-a1b2</text>
    <rect x="675" y="206" width="170" height="24" rx="6" fill="#3fb950" opacity="0.1"/>
    <text x="760" y="222" text-anchor="middle" font-family="'Segoe UI',system-ui,sans-serif" font-size="12" fill="#3fb950" font-weight="700">âœ… Match! Proceed</text>
  </g>
</svg>
